From 15db1ef0f561309e2b475df3993c8f185d19a7eb Mon Sep 17 00:00:00 2001
From: Xin Ouyang <Xin.Ouyang@windriver.com>
Date: Wed, 29 Feb 2012 17:42:57 +0800
Subject: [PATCH] Fix LSB routines for non-LSB releases.

---
 scripts/init.d/cgconfig.in |   49 ++++++++++++++++++++++++++++++++++++++++---
 scripts/init.d/cgred.in    |   45 +++++++++++++++++++++++++++++++++++++++-
 2 files changed, 89 insertions(+), 5 deletions(-)

diff --git a/scripts/init.d/cgconfig.in b/scripts/init.d/cgconfig.in
index 14aa2e3..6ca9ecf 100644
--- a/scripts/init.d/cgconfig.in
+++ b/scripts/init.d/cgconfig.in
@@ -36,10 +36,51 @@ CONFIG_FILE=/etc/cgconfig.conf
 servicename=cgconfig
 lockfile=/var/lock/subsys/$servicename
 
-#
-# Source LSB routines
-#
-. /lib/lsb/init-functions
+# for log_success_msg and friends
+if [ -r /lib/lsb/init-functions ]; then
+# LSB, SLES, ...
+    . /lib/lsb/init-functions
+elif [ -r /etc/init.d/functions ]; then
+# Red Hat / VMware
+    . /etc/init.d/functions
+    my_log_message()
+    {
+        ACTION=$1
+        shift
+
+        case "$ACTION" in
+            success)
+                echo -n $*
+                success "$*"
+                echo
+                ;;
+            failure)
+                echo -n $*
+                failure "$*"
+                echo
+                ;;
+            warning)
+                echo -n $*
+                warning "$*"
+                echo
+                ;;
+            *)
+                ;;
+        esac
+    }
+    log_success_msg()
+    {
+        my_log_message success "$*"
+    }
+    log_failure_msg()
+    {
+        my_log_message failure "$*"
+    }
+    log_warning_msg()
+    {
+        my_log_message warning "$*"
+    }
+fi
 
 # read the config
 CREATE_DEFAULT=yes
diff --git a/scripts/init.d/cgred.in b/scripts/init.d/cgred.in
index 9ff2d9b..4b02536 100644
--- a/scripts/init.d/cgred.in
+++ b/scripts/init.d/cgred.in
@@ -41,7 +41,50 @@ CGRED_CONF=/etc/cgrules.conf
 
 # Source function library & LSB routines
 . /etc/rc.d/init.d/functions
-. /lib/lsb/init-functions
+# for log_success_msg and friends
+if [ -r /lib/lsb/init-functions ]; then
+# LSB, SLES, ...
+    . /lib/lsb/init-functions
+elif [ -r /etc/init.d/functions ]; then
+# Red Hat / VMware
+    my_log_message()
+    {
+        ACTION=$1
+        shift
+
+        case "$ACTION" in
+            success)
+                echo -n $*
+                success "$*"
+                echo
+                ;;
+            failure)
+                echo -n $*
+                failure "$*"
+                echo
+                ;;
+            warning)
+                echo -n $*
+                warning "$*"
+                echo
+                ;;
+            *)
+                ;;
+        esac
+    }
+    log_success_msg()
+    {
+        my_log_message success "$*"
+    }
+    log_failure_msg()
+    {
+        my_log_message failure "$*"
+    }
+    log_warning_msg()
+    {
+        my_log_message warning "$*"
+    }
+fi
 
 # Read in configuration options.
 if [ -f "/etc/sysconfig/cgred.conf" ] ; then
-- 
1.7.5.4

